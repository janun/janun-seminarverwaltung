{% extends "base.html" %}
{% load crispy_forms_tags %}


{% block title %}{{ block.super }} {{ seminar.title }}{% endblock %}


{% block css %}
{{ block.super }}
<style>
  .optionalField {
    display: none;
  }
</style>
{% endblock css %}


{% block content %}
<div class="mx-auto max-w-3xl">

  <div class="mb-5">
  {% if user.is_staff %}
      <a class="float-right text-gray-600" href="{% url 'admin:seminars_seminar_change' seminar.pk %}">Verwaltungsansicht →</a>
    {% endif %}
    <h1 class="font-bold text-2xl text-green-500">{{ seminar.title }}</h1>
  </div>

  <div class="mb-1">
    Am {{ seminar.start_date | date }}
    {% if seminar.location %}<span>in {{ seminar.location }}</span>{% endif %}
  </div>

  <div class="text-sm">
    {% if seminar.owner %}
      <div>
        Besitzer_in:
        {% if user.is_staff %}
          <a class="text-green-500" href="{% url 'admin:users_user_change' seminar.owner.pk %}">{{ seminar.owner.name }}</a>
        {% else %}
          {{ seminar.owner.name }}
        {% endif %}
      </div>
    {% endif %}

    {% if seminar.group %}
      <div>
        JANUN-Gruppe:
        <a class="text-green-500" href="{{ seminar.group.get_absolute_url }}">
          {{ seminar.group.name }}
        </a>
      </div>
    {% endif %}

    {% if seminar.deadline_applicable %}
      <div>
        Abrechnungs-Deadline: {{ seminar.deadline | date }}
        {% if seminar.deadline_status == 'expired' %}
          <span class="px-2 bg-red-300 rounded-sm ml-1">abgelaufen!</span>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <form class="mb-12 {% if not form.editable %}not-editable{% endif %}" method="post">
    {% csrf_token %}
    <div class="flex">
      <button class="ml-auto button button-primary" type="submit">Speichern</button>
    </div>
    
    <div class="{% if form.editable %}border-t-2 border-gray-300{% endif %} mt-5 pt-5">
      {% crispy form %}
    </div>
    
    <div class="flex">
      <button class="ml-auto button button-primary" type="submit">Speichern</button>
    </div>
  </form>

  {% if comments %}
  <h2 id="comments" class="text-green-500 font-bold mb-3 text-base">Kommentare</h2>
    {% for comment in comments %}
      <div class="bg-white shadow max-w-lg my-5 px-4 pt-2 pb-4 rounded">
        <div class="text-xs my-2 text-gray-600">
          {{ comment.owner }}, {{ comment.created_at|date:"d.m.y H:i" }}
          {% if comment.was_edited %}, (bearbeitet {{ comment.updated_at|date:"d.m.y H:i" }}){% endif %}
          <!-- <div class="float-right">
            <button type="button" class="hover:text-gray-900 mx-1 select-none">bearbeiten</button>
            <button type="button" class="hover:text-gray-900 mx-1 select-none">löschen</button>
          </div>-->
        </div>
        <p class="whitespace-pre-wrap">{{ comment.text }}</p>
      </div>
    {% endfor %}
  {% endif %}

</div>
{% endblock content %}