{% extends "base.html" %}

{% load rules %}
{% load utils %}

{% block title %}{{ block.super }} {{ object.name }}{% endblock %}

{% block content %}
<a class="backlink" href="{% url 'groups:list' %}">← Alle Gruppen</a>

<div class="clearfix mb-4">
  <div class="float-right">
    {% has_perm 'groups.change_janungroup' user object as can_edit %}
    {% if can_edit %}
      <a class="btn my-1 btn-outline-info float-right" href="{% url 'groups:edit' object.id %}"><i class="fas fa-edit"></i> bearbeiten</a>
    {% endif %}
    <br>
    {% has_perm 'groups.delete_janungroup' user object as can_delete %}
    {% if can_delete %}
      <a class="btn my-1 btn-outline-danger float-right" href="{% url 'groups:delete' object.id %}"><i class="fas fa-trash"></i> löschen</a>
    {% endif %}
  </div>

  <div class="row">
    <div class="col-lg-2">
      {% include "groups/_group_logo.html" with logo=object.logo %}
    </div>
    <div class="col col-lg-8">
      <h1>{{ object.name }}</h1>
      <strong>Gruppenhut:</strong> {{ object.group_hats.all|link_list|default:"niemand" }}<br>
    </div>
  </div>
</div>

{% if object.contact_people.all|length < 3 %}
  <div class="callout callout-danger clearfix my-4 mw-500">
    <div class="card-body">
      <a class="btn btn-outline-primary float-right" href="{% url 'groups:edit' object.pk %}#contact_people">eintragen</a>
      {% if object.contact_people.all|length > 0 %}
        Zu dieser Gruppe wurden weniger als drei Konktaktpersonen eingetragen.
      {% else %}
        Zu dieser Gruppe wurden noch keine Konktaktpersonen eingetragen.
      {% endif %}
    </div>
  </div>
{% endif %}


<div class="card-deck">

<div class="card my-4">
  <h2 class="card-header bg-white mt-2 h5">Statistik</h2>
  <div class="card-body">
    <table class="table card-text table-sm">
      <tr>
        <th><strong>Anzahl:</strong></th>
        <td>{{ seminar_stats.count }}</td>
      </tr>
      <tr>
        <th><strong>Förderung:</strong></th>
        <td>{{ seminar_stats.requested_funding }} €</td>
      </tr>
      <tr>
        <th><strong>TNT:</strong></th>
        <td>{{ seminar_stats.requested_tnt }}</td>
      </tr>
      <tr>
        <th><strong>Förderung / TNT:</strong></th>
        <td>{{ seminar_stats.requested_funding_over_tnt|floatformat:2 }} €/TNT</td>
      </tr>
    </table>
  </div>
</div>


<div class="card my-4">
  <h2 class="card-header bg-white mt-2 h5">Mitglieder</h2>
  <ul class="list-group list-group-flush">
    {% for member in object.members.all %}
      <li class="list-group-item">{% include "users/_user.html" with object=member %}</li>
    {% empty %}
      <li class="list-group-item">keine eingetragen</li>
    {% endfor %}
  </ul>
</div>

</div>


<div class="card">
  <h2 class="card-header bg-white mt-2 h5">Kontaktdaten</h2>
  <div class="card-body">
    <strong><i class="fas fa-globe"></i> Homepage:</strong> {% if object.homepage %}<a href="{{ object.homepage }}">{{ object.homepage }}</a>{% else %}keine{% endif %}<br>
    <strong><i class="fas fa-at"></i> E-Mail:</strong> {% if object.email %}<a href="mailto:{{ object.email }}">{{ object.email }}</a>{% else %}keine{% endif %}
    <p><strong><i class="fas fa-envelope"></i> Postadresse:</strong><br> {{ object.address|default:"keine"|linebreaksbr }}</p>
  </div>

  <h4 class="card-header bg-white font-weight-normal h5">Kontaktpersonen</h4>
  <ul class="list-group list-group-flush">
    {% if contact_people %}
      {% for person in contact_people %}
        <li class="list-group-item">
          {{ person.name }},
          {% if person.email %}<a href="mailto:{{ person.email }}">{{ person.email }}</a>,{% endif %}
          {% if person.phone %}<a href="{{ person.phone.as_rfc3966 }}">{{ person.phone.as_national }}</a>{% endif %}
        </li>
      {% endfor %}
    {% else %}
      <li class="list-group-item">keine eingetragen</li>
    {% endif %}
  </ul>

</div>

{% endblock %}
